---
title: 20260115
date: 2026-01-15
category: blog
tags:
  - blog
---

## 1. 手动创建android项目支持uniappx

> 官方文档: https://doc.dcloud.net.cn/uni-app-x/native/use/android.html

### 环境要求（正式版）

| 组件 | 版本 | 备注 |
|------|------|------|
| Java | 17 | Oracle JDK 或 OpenJDK |
| Gradle | 8.4 | |
| AGP | 8.2.2 | Android Gradle Plugin |
| Kotlin 插件 | 1.9.10 | |
| kotlin-stdlib | 2.2.0 | 运行时依赖 |
| Android Studio | 2023.2.1 Patch 2 | 可选，命令行可不用 |

### 相关链接

- [uni-app x 原生SDK Android版](https://doc.dcloud.net.cn/uni-app-x/native/use/android.html)
- [uni-app x Android原生SDK 下载](https://doc.dcloud.net.cn/uni-app-x/native/download/android.html)
- [Android cmdline-tools](https://developer.android.com/studio?hl=zh-cn#command-line-tools-only)
- [Gradle 8.4](https://gradle.org/releases/#8.4)
- [Java 17](https://www.oracle.com/java/technologies/downloads/#java17)


### 2 Android 命令行创建项目

#### 背景说明

早期 Android SDK 提供了 `android create project` 命令来创建项目，但该命令已被废弃。目前 `gradle init` 也不支持直接创建 Android 项目模板。因此，需要**手动创建项目结构**或使用 Android Studio 生成模板后复用。

#### 环境准备

目录结构：
```
D:\soft\Android\
├── cmdline-tools\    # Android SDK 命令行工具
├── gradle-8.4\       # Gradle
└── Sdk\              # Android SDK（可选，Android Studio 自带）
```

##### 1. Java（已有 ✅）

```bash
java -version
# Java 17+ 即可
```

##### 2. Gradle 环境变量配置

下载 [gradle-8.4-bin.zip](https://gradle.org/releases/#8.4) 解压到 `D:\soft\Android\gradle-8.4`

```powershell
# 设置环境变量
[Environment]::SetEnvironmentVariable("GRADLE_HOME", "D:\soft\Android\gradle-8.4", "User")
$env:Path += ";D:\soft\Android\gradle-8.4\bin"
[Environment]::SetEnvironmentVariable("Path", $env:Path, "User")

# 验证
gradle -v
```

##### 3. Android SDK cmdline-tools 环境变量配置

下载 [commandlinetools-win](https://developer.android.com/studio?hl=zh-cn#command-line-tools-only) 解压到 `D:\soft\Android\cmdline-tools`

```powershell
# 设置环境变量
[Environment]::SetEnvironmentVariable("ANDROID_HOME", "D:\soft\Android\Sdk", "User")
$env:Path += ";D:\soft\Android\cmdline-tools\bin;D:\soft\Android\Sdk\platform-tools"
[Environment]::SetEnvironmentVariable("Path", $env:Path, "User")
```

##### 4. sdkmanager 操作

**Step 1: 接受许可协议（必须）**

```powershell
sdkmanager --sdk_root=D:\soft\Android\Sdk --licenses
# 输入 y 接受所有许可
```

**Step 2: 查看可用组件**

```powershell
sdkmanager --sdk_root=D:\soft\Android\Sdk --list
```

**Step 3: 安装必要组件（逐个安装更稳定）**

```powershell
sdkmanager --sdk_root=D:\soft\Android\Sdk "platform-tools"
sdkmanager --sdk_root=D:\soft\Android\Sdk "platforms;android-34"
sdkmanager --sdk_root=D:\soft\Android\Sdk "build-tools;34.0.0"
```

**常见问题：Error on ZipFile unknown archive**

```powershell
# 方案1：使用国内镜像
sdkmanager --sdk_root=D:\soft\Android\Sdk --no_https --proxy=http --proxy_host=mirrors.cloud.tencent.com --proxy_port=80 "platform-tools"

sdkmanager --sdk_root=D:\soft\Android\Sdk --no_https --proxy=http --proxy_host=mirrors.cloud.tencent.com --proxy_port=80 "platforms;android-34"

sdkmanager --sdk_root=D:\soft\Android\Sdk --no_https --proxy=http --proxy_host=mirrors.cloud.tencent.com --proxy_port=80 "build-tools;35.0.0"

# 方案2：检查已有 SDK（Android Studio 已安装的）
ls D:\soft\Android\Sdk\

# 方案3：清理缓存重试
Remove-Item -Recurse -Force "$env:USERPROFILE\.android\cache"
sdkmanager --sdk_root=D:\soft\Android\Sdk "platform-tools"
```

**查看已安装组件**

```powershell
sdkmanager --sdk_root=D:\soft\Android\Sdk --list_installed
```

##### 验证安装

```bash
java -version     # ✅ Java 18
gradle -v         # ✅ Gradle 8.4
sdkmanager --list # 显示已安装的 SDK 组件
```

### 1.2 一键创建项目（CLI 脚手架）

#### 使用脚手架脚本

```bash
# 下载脚本（或复制到本地）
# 脚本位置: scripts/create-uniappx-project.sh

# 赋予执行权限
chmod +x create-uniappx-project.sh

# 创建项目
./create-uniappx-project.sh MyApp com.example.myapp
```

#### 脚本功能

脚本会自动执行以下操作：
1. 创建项目目录结构（app + uniappx 模块）
2. 生成 `settings.gradle`、`build.gradle`、`gradle.properties`
3. 配置 uni-app x 所需的所有依赖
4. 创建 `AndroidManifest.xml` 和 `MainActivity.kt`
5. 初始化 Gradle Wrapper (8.4)
6. 复制 uni-app x SDK aar 文件

#### 项目结构

```
MyApp/
├── settings.gradle
├── build.gradle
├── gradle.properties
├── gradlew / gradlew.bat
├── app/
│   ├── build.gradle
│   └── src/main/
│       ├── AndroidManifest.xml
│       ├── java/com/example/myapp/MainActivity.kt
│       └── res/values/strings.xml
└── uniappx/
    ├── build.gradle
    ├── libs/          # 放置 uni-app x SDK aar 文件
    └── src/main/AndroidManifest.xml
```

#### 手动补充 aar 文件

将 `D:\soft\Android\plugins` 中的核心 aar 文件复制到 `uniappx/libs/`：

```bash
# 必须的 19 个核心 aar
cp /d/soft/Android/plugins/uts-runtime-release.aar uniappx/libs/
cp /d/soft/Android/plugins/app-common-release.aar uniappx/libs/
cp /d/soft/Android/plugins/app-runtime-release.aar uniappx/libs/
cp /d/soft/Android/plugins/framework-release.aar uniappx/libs/
cp /d/soft/Android/plugins/breakpad-build-release.aar uniappx/libs/
cp /d/soft/Android/plugins/dcloud-layout-release.aar uniappx/libs/
# ... 其他 aar 文件
```

#### 构建项目

```bash
cd MyApp
./gradlew assembleDebug
```

运行项目：https://dev.dcloud.net.cn/pages/app/list