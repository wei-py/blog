---
title: Swift å±æ€§è¯¦è§£ï¼šä»åŸºç¡€åˆ°å®æˆ˜
date: 2025-11-25
category: swift
tags:
  - Swift
  - å±æ€§
  - iOSå¼€å‘
---

---

## ğŸŒŸ åœºæ™¯ï¼š**ç”¨æˆ·å¥åº·è¿½è¸ª App çš„ `UserProfile` æ¨¡å‹**

æˆ‘ä»¬è¦å»ºä¸€ä¸ª `UserProfile`ï¼Œç”¨äºè®°å½•ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€å¥åº·æ•°æ®ï¼Œå¹¶åœ¨æ•°æ®å˜åŠ¨æ—¶è‡ªåŠ¨åŒæ­¥ã€éªŒè¯ã€ä¿å­˜ã€‚

### âœ… éœ€æ±‚æ•´åˆï¼š

- ç”¨æˆ·èº«é«˜ã€ä½“é‡ï¼ˆå¯ä¿®æ”¹ï¼‰
- BMI è‡ªåŠ¨è®¡ç®—ï¼ˆåªè¯»ï¼‰
- æ­¥æ•°æ›´æ–°æ—¶è‡ªåŠ¨è®°å½•å˜åŒ–ï¼ˆè§‚å¯Ÿå™¨ï¼‰
- å¤´åƒè·¯å¾„å»¶è¿ŸåŠ è½½ï¼ˆ`lazy`ï¼‰
- ç”¨æˆ·çŠ¶æ€ï¼ˆå¦‚â€œæ´»è·ƒâ€â€œä¼‘çœ â€ï¼‰ä¸ºç±»å‹å±æ€§ï¼ˆå…¨å±€å…±äº«ï¼‰
- å¹´é¾„å¿…é¡» â‰¥ 0ï¼ˆå±æ€§åŒ…è£…å™¨ï¼‰
- è®°å½•å¹´é¾„æ˜¯å¦æ›¾è¢«éæ³•è®¾ç½®ï¼ˆæŠ•å½±å€¼ï¼‰


## ğŸ§© å®Œæ•´ä»£ç ç¤ºä¾‹

```swift
import Foundation

// ===== 1. å±æ€§åŒ…è£…å™¨ï¼šç¡®ä¿å¹´é¾„éè´Ÿï¼Œå¹¶è®°å½•æ˜¯å¦è¢«ä¿®æ­£ =====
@propertyWrapper
struct NonNegativeAge {
    private var value: Int
    private(set) var projectedValue: Bool = false // æŠ•å½±å€¼ï¼šæ˜¯å¦æ›¾è¢«ä¿®æ­£

    var wrappedValue: Int {
        get { value }
        set {
            if newValue < 0 {
                value = 0
                projectedValue = true
            } else {
                value = newValue
                projectedValue = false
            }
        }
    }

    init(wrappedValue: Int) {
        self.wrappedValue = wrappedValue // ä¼šè§¦å‘ setter
    }
}

// ===== 2. UserProfile ç»“æ„ä½“ =====
struct UserProfile {
    // å­˜å‚¨å±æ€§ï¼ˆå¯å˜ï¼‰
    var name: String

    // ä½¿ç”¨å±æ€§åŒ…è£…å™¨çš„å­˜å‚¨å±æ€§
    @NonNegativeAge var age: Int

    // å­˜å‚¨å±æ€§ï¼ˆå¸¸é‡ï¼‰
    let id: UUID = UUID()

    // å»¶è¿ŸåŠ è½½å±æ€§ï¼šå¤´åƒè·¯å¾„ï¼ˆä»…å½“é¦–æ¬¡è®¿é—®æ—¶ç”Ÿæˆï¼‰
    lazy var avatarURL: String = {
        print("ğŸ”„ ç”Ÿæˆå¤´åƒè·¯å¾„...")
        return "https://avatar.example.com/\(id.uuidString).jpg"
    }()

    // è®¡ç®—å±æ€§ï¼ˆåªè¯»ï¼‰ï¼šè‡ªåŠ¨è®¡ç®— BMI
    var bmi: Double {
        guard height > 0 else { return 0 }
        return weight / (height * height)
    }

    // å¯å˜å­˜å‚¨å±æ€§ï¼šç”¨äºè®¡ç®— BMI
    var height: Double = 1.70 // ç±³
    var weight: Double = 70.0 // å…¬æ–¤

    // å±æ€§è§‚å¯Ÿå™¨ï¼šç›‘æ§æ­¥æ•°å˜åŒ–
    var dailySteps: Int = 0 {
        willSet {
            print("ğŸ‘£ å³å°†æ›´æ–°æ­¥æ•°ï¼š\(newValue)")
        }
        didSet {
            if dailySteps > oldValue {
                print("ğŸ“ˆ æ­¥æ•°å¢åŠ äº† \(dailySteps - oldValue) æ­¥")
                // æ¨¡æ‹Ÿï¼šè‡ªåŠ¨ä¿å­˜åˆ° UserDefaults
                UserDefaults.standard.set(dailySteps, forKey: "DailySteps")
            }
        }
    }

    // ===== ç±»å‹å±æ€§ï¼šæ‰€æœ‰ç”¨æˆ·å…±äº«çš„â€œç³»ç»ŸçŠ¶æ€â€ =====
    static var systemStatus: String = "active" // å¯å˜ç±»å‹å±æ€§
    static let appVersion: String = "1.0"      // å¸¸é‡ç±»å‹å±æ€§
}
```

---

## ğŸ” ä½¿ç”¨ç¤ºä¾‹

```swift
// åˆ›å»ºç”¨æˆ·
var user = UserProfile(name: "Jackson", age: 25)

// 1ï¸âƒ£ å­˜å‚¨å±æ€§è®¿é—®
print("ID: \(user.id)")

// 2ï¸âƒ£ å»¶è¿ŸåŠ è½½å±æ€§ï¼ˆé¦–æ¬¡è®¿é—®æ‰æ‰§è¡Œï¼‰
print("Avatar: \(user.avatarURL)") // è¾“å‡ºæ—¶ä¼šæ‰“å° "ğŸ”„ ç”Ÿæˆå¤´åƒè·¯å¾„..."

// 3ï¸âƒ£ è®¡ç®—å±æ€§
print("BMI: \(user.bmi, specifier: "%.1f")") // è¾“å‡º BMI

// 4ï¸âƒ£ å±æ€§è§‚å¯Ÿå™¨
user.dailySteps = 1000 // è§¦å‘ willSet + didSet
user.dailySteps = 1500 // å†æ¬¡è§¦å‘

// 5ï¸âƒ£ ç±»å‹å±æ€§ï¼ˆé€šè¿‡ç±»å‹è®¿é—®ï¼‰
print("App version: \(UserProfile.appVersion)")
UserProfile.systemStatus = "maintenance"
print("System status: \(UserProfile.systemStatus)")

// 6ï¸âƒ£ å±æ€§åŒ…è£…å™¨ + æŠ•å½±å€¼
user.age = -5 // è¢«ä¿®æ­£ä¸º 0
print("Age: \(user.age)")           // 0
print("Age was invalid: \(user.$age)") // trueï¼ˆæŠ•å½±å€¼ï¼‰

user.age = 30
print("Age: \(user.age)")           // 30
print("Age was invalid: \(user.$age)") // false
```

---

## ğŸ“Œ å„å±æ€§ç±»å‹æ€»ç»“å›é¡¾

| å±æ€§ç±»å‹         | åœ¨ä»£ç ä¸­çš„ä½“ç°                   | ä½œç”¨                       |
| ---------------- | -------------------------------- | -------------------------- |
| **å­˜å‚¨å±æ€§**     | `name`, `id`, `height`, `weight` | å­˜åŸå§‹æ•°æ®                 |
| **å¸¸é‡å­˜å‚¨å±æ€§** | `let id`                         | ä¸å¯ä¿®æ”¹                   |
| **è®¡ç®—å±æ€§**     | `bmi`                            | åŠ¨æ€è®¡ç®—ï¼Œæ— å­˜å‚¨           |
| **å»¶è¿ŸåŠ è½½å±æ€§** | `lazy var avatarURL`             | é¦–æ¬¡è®¿é—®æ‰åˆå§‹åŒ–           |
| **å±æ€§è§‚å¯Ÿå™¨**   | `dailySteps` çš„ `willSet/didSet` | ç›‘æ§å˜åŒ–ã€è§¦å‘å‰¯ä½œç”¨       |
| **ç±»å‹å±æ€§**     | `static var systemStatus`        | æ‰€æœ‰å®ä¾‹å…±äº«               |
| **å±æ€§åŒ…è£…å™¨**   | `@NonNegativeAge var age`        | å¤ç”¨éªŒè¯é€»è¾‘               |
| **æŠ•å½±å€¼**       | `user.$age`                      | æš´éœ²é¢å¤–çŠ¶æ€ï¼ˆæ˜¯å¦è¢«ä¿®æ­£ï¼‰ |

---

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™ä¸ªä¾‹å­å¥½ï¼Ÿ

- **çœŸå®æ„Ÿå¼º**ï¼šæ¨¡æ‹Ÿäº† App ä¸­å¸¸è§çš„ç”¨æˆ·æ¨¡å‹ã€‚
- **è¦†ç›–å…¨é¢**ï¼š8 ç§å±æ€§ç”¨æ³•å…¨éƒ¨åŒ…å«ã€‚
- **é€»è¾‘è¿è´¯**ï¼šå„å±æ€§ä¹‹é—´æœ‰ä¸šåŠ¡å…³è”ï¼ˆå¦‚ BMI ä¾èµ– height/weightï¼‰ã€‚
- **å¯è¿è¡Œ**ï¼šå¤åˆ¶åˆ° Playground æˆ– Xcode å³å¯æµ‹è¯•ã€‚

---

```swift
import SwiftUI

@propertyWrapper
struct NonNegativeAge {
    private var value: Int
    private(set) var projectedValue: Bool = false
    var wrappedValue: Int {
        get { value }
        set {
            if newValue < 0 {
                value = 0
                projectedValue = true
            } else {
                value = newValue
                projectedValue = false
            }
        }
    }
    init(wrappedValue: Int) {
        if wrappedValue < 0 {
            self.value = 0
            self.projectedValue = true
        } else {
            self.value = wrappedValue
            self.projectedValue = false
        }
    }
}

struct UserProfile {
    var name: String
    @NonNegativeAge var age: Int
    let id: UUID = UUID()
    lazy var avatarURL: String = {
        return "https://avatar.example.com/\(id.uuidString).jpg"
    }()
    var bmi: Double {
        guard height > 0 else { return 0 }
        return weight / (height * height)
    }
    var height: Double = 1.70
    var weight: Double = 70.0
    var dailySteps: Int = 0 {
        willSet {
            print("å³å°†æ›´æ–°æ­¥æ•°ï¼š\(newValue)")
        }
        didSet {
            if dailySteps > oldValue {
                UserDefaults.standard.set(dailySteps, forKey: "DailySteps")
            }
        }
    }
    static var systemStatus: String = "active"
    static let appVersion: String = "1.0"
}

struct PropertyPage: View {
    @State private var user = UserProfile(name: "Jackson", age: 25)
    @State private var showAvatar = false
    @State private var selectedStatus = UserProfile.systemStatus

    var body: some View {
        NavigationView {
            ScrollView {
                VStack(alignment: .leading, spacing: 16) {
                    Text("ç”¨æˆ·å¥åº·è¿½è¸ª App çš„ UserProfile æ¨¡å‹")
                        .font(.title2)
                        .bold()
                    Text("éœ€æ±‚æ•´åˆ")
                        .font(.headline)
                    VStack(alignment: .leading, spacing: 8) {
                        Text("â€¢ ç”¨æˆ·èº«é«˜ã€ä½“é‡ï¼ˆå¯ä¿®æ”¹ï¼‰")
                        Text("â€¢ BMI è‡ªåŠ¨è®¡ç®—ï¼ˆåªè¯»ï¼‰")
                        Text("â€¢ æ­¥æ•°æ›´æ–°æ—¶è‡ªåŠ¨è®°å½•å˜åŒ–ï¼ˆè§‚å¯Ÿå™¨ï¼‰")
                        Text("â€¢ å¤´åƒè·¯å¾„å»¶è¿ŸåŠ è½½ï¼ˆlazyï¼‰")
                        Text("â€¢ ç”¨æˆ·çŠ¶æ€ä¸ºç±»å‹å±æ€§ï¼ˆå…¨å±€å…±äº«ï¼‰")
                        Text("â€¢ å¹´é¾„å¿…é¡» â‰¥ 0ï¼ˆå±æ€§åŒ…è£…å™¨ï¼‰")
                        Text("â€¢ è®°å½•å¹´é¾„æ˜¯å¦æ›¾è¢«éæ³•è®¾ç½®ï¼ˆæŠ•å½±å€¼ï¼‰")
                    }
                    Group {
                        Text("åŸºç¡€ä¿¡æ¯")
                            .font(.headline)
                        HStack {
                            Text("å§“å")
                            Spacer()
                            TextField("å§“å", text: Binding(
                                get: { user.name },
                                set: { user.name = $0 }
                            ))
                            .textFieldStyle(.roundedBorder)
                            .frame(maxWidth: 200)
                        }
                        HStack {
                            Text("å¹´é¾„")
                            Spacer()
                            TextField("å¹´é¾„", value: Binding(
                                get: { user.age },
                                set: { user.age = $0 }
                            ), format: .number)
                            .textFieldStyle(.roundedBorder)
                            .frame(maxWidth: 200)
                        }
                        HStack {
                            Text("å¹´é¾„æ˜¯å¦è¢«ä¿®æ­£")
                            Spacer()
                            Text(user.$age ? "æ˜¯" : "å¦")
                                .foregroundColor(user.$age ? .orange : .secondary)
                        }
                    }
                    Group {
                        Text("å¥åº·æ•°æ®")
                            .font(.headline)
                        HStack {
                            Text("èº«é«˜ï¼ˆç±³ï¼‰")
                            Spacer()
                            Slider(value: Binding(
                                get: { user.height },
                                set: { user.height = $0 }
                            ), in: 1.2...2.2, step: 0.01)
                            Text(user.height, format: .number.precision(.fractionLength(2)))
                                .monospacedDigit()
                        }
                        HStack {
                            Text("ä½“é‡ï¼ˆå…¬æ–¤ï¼‰")
                            Spacer()
                            Slider(value: Binding(
                                get: { user.weight },
                                set: { user.weight = $0 }
                            ), in: 35...150, step: 0.1)
                            Text(user.weight, format: .number.precision(.fractionLength(1)))
                                .monospacedDigit()
                        }
                        HStack {
                            Text("BMI")
                            Spacer()
                            Text(bmiText(user.bmi))
                                .monospacedDigit()
                                .bold()
                        }
                    }
                    Group {
                        Text("æ­¥æ•°è§‚å¯Ÿå™¨")
                            .font(.headline)
                        HStack {
                            Stepper("æ­¥æ•° \(user.dailySteps)", value: Binding(
                                get: { user.dailySteps },
                                set: { user.dailySteps = $0 }
                            ), in: 0...50000, step: 500)
                        }
                        Text("æœ€è¿‘æ­¥æ•°å·²ä¿å­˜åˆ°ç³»ç»Ÿå­˜å‚¨")
                            .font(.footnote)
                            .foregroundColor(.secondary)
                    }
                    Group {
                        Text("å»¶è¿ŸåŠ è½½å¤´åƒ")
                            .font(.headline)
                        Button {
                            showAvatar.toggle()
                            _ = user.avatarURL
                        } label: {
                            Text(showAvatar ? "éšè—å¤´åƒè·¯å¾„" : "ç”Ÿæˆå¹¶æ˜¾ç¤ºå¤´åƒè·¯å¾„")
                        }
                        if showAvatar {
                            Text(user.avatarURL)
                                .font(.system(.body, design: .monospaced))
                                .padding(8)
                                .background(Color.gray.opacity(0.1))
                                .cornerRadius(8)
                        }
                    }
                    Group {
                        Text("ç±»å‹å±æ€§")
                            .font(.headline)
                        HStack {
                            Text("App ç‰ˆæœ¬")
                            Spacer()
                            Text(UserProfile.appVersion)
                        }
                        Picker("ç³»ç»ŸçŠ¶æ€", selection: $selectedStatus) {
                            Text("active").tag("active")
                            Text("maintenance").tag("maintenance")
                            Text("sleep").tag("sleep")
                        }
                        .onChange(of: selectedStatus) { value in
                            UserProfile.systemStatus = value
                        }
                        HStack {
                            Text("å½“å‰ç³»ç»ŸçŠ¶æ€")
                            Spacer()
                            Text(UserProfile.systemStatus)
                        }
                    }
                    Group {
                        Text("ä»£ç ç¤ºä¾‹")
                            .font(.headline)
                        Text(codeSample)
                            .font(.system(.footnote, design: .monospaced))
                            .padding(8)
                            .background(Color.gray.opacity(0.1))
                            .cornerRadius(8)
                    }
                }
                .padding()
            }
            .navigationTitle("Swift å±æ€§ç»¼åˆç¤ºä¾‹")
        }
    }

    private func bmiText(_ bmi: Double) -> String {
        String(format: "%.1f", bmi)
    }

    private var codeSample: String {
        """
        @propertyWrapper
        struct NonNegativeAge {
            private var value: Int
            private(set) var projectedValue: Bool = false
            var wrappedValue: Int {
                get { value }
                set {
                    if newValue < 0 {
                        value = 0
                        projectedValue = true
                    } else {
                        value = newValue
                        projectedValue = false
                    }
                }
            }
            init(wrappedValue: Int) {
                self.wrappedValue = wrappedValue
            }
        }

        struct UserProfile {
            var name: String
            @NonNegativeAge var age: Int
            let id: UUID = UUID()
            lazy var avatarURL: String = {
                return "https://avatar.example.com/\\(id.uuidString).jpg"
            }()
            var bmi: Double {
                guard height > 0 else { return 0 }
                return weight / (height * height)
            }
            var height: Double = 1.70
            var weight: Double = 70.0
            var dailySteps: Int = 0 {
                willSet { print("å³å°†æ›´æ–°æ­¥æ•°ï¼š\\(newValue)") }
                didSet {
                    if dailySteps > oldValue {
                        UserDefaults.standard.set(dailySteps, forKey: "DailySteps")
                    }
                }
            }
            static var systemStatus: String = "active"
            static let appVersion: String = "1.0"
        }
        """
    }
}

#Preview {
    PropertyPage()
}
```
