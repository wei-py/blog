import{_ as i,c as a,o as n,ah as t}from"./chunks/framework.ptg7Kx6M.js";const g=JSON.parse('{"title":"fetch äºŒæ¬¡å°è£…","description":"","frontmatter":{"title":"fetch äºŒæ¬¡å°è£…","date":"2025-09-04T00:00:00.000Z","category":"next","tags":["next","fetch"]},"headers":[],"relativePath":"posts/next/fetchäºŒæ¬¡å°è£….md","filePath":"posts/next/fetchäºŒæ¬¡å°è£….md"}'),h={name:"posts/next/fetchäºŒæ¬¡å°è£….md"};function l(k,s,p,e,r,d){return n(),a("div",null,s[0]||(s[0]=[t(`<p>Q: é‚£æˆ‘è¿˜æœ‰äºŒæ¬¡å°è£…ä¸€ä¸‹fetchæ¥ä½¿ç”¨ï¼Œè¿™æ ·ç»“åˆnextçš„ä¼˜åŠ¿</p><p>éå¸¸å¥½çš„é—®é¢˜ï¼ğŸ‘</p><p>ä½ é—®çš„æ˜¯ï¼š<strong>â€œæˆ‘æ˜¯å¦åº”è¯¥å¯¹ <code>fetch</code> è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œæ¥æ›´å¥½åœ°ç»“åˆ Next.js çš„ä¼˜åŠ¿ï¼Ÿâ€</strong></p><h3 id="âœ…-ç®€çŸ­å›ç­”" tabindex="-1">âœ… ç®€çŸ­å›ç­”ï¼š <a class="header-anchor" href="#âœ…-ç®€çŸ­å›ç­”" aria-label="Permalink to &quot;âœ… ç®€çŸ­å›ç­”ï¼š&quot;">â€‹</a></h3><blockquote><p><strong>å¯ä»¥å°è£…ï¼Œä½†è¦â€œæ™ºèƒ½å°è£…â€â€”â€”ä¸è¦ç ´å Next.js å¯¹ <code>fetch</code> çš„åŸç”Ÿå¢å¼ºï¼ˆå¦‚ç¼“å­˜ã€revalidateã€æµå¼æ¸²æŸ“ï¼‰</strong>ã€‚</p></blockquote><hr><h2 id="ğŸ§©-ä¸€ã€next-js-å¯¹-fetch-çš„å¢å¼º-ä¸èƒ½ä¸¢" tabindex="-1">ğŸ§© ä¸€ã€Next.js å¯¹ <code>fetch</code> çš„å¢å¼ºï¼ˆä¸èƒ½ä¸¢ï¼‰ <a class="header-anchor" href="#ğŸ§©-ä¸€ã€next-js-å¯¹-fetch-çš„å¢å¼º-ä¸èƒ½ä¸¢" aria-label="Permalink to &quot;ğŸ§© ä¸€ã€Next.js å¯¹ \`fetch\` çš„å¢å¼ºï¼ˆä¸èƒ½ä¸¢ï¼‰&quot;">â€‹</a></h2><p>Next.js åœ¨æœåŠ¡ç«¯ï¼ˆServer Componentsï¼‰ä¸­å¯¹åŸç”Ÿ <code>fetch</code> åšäº†å…³é”®å¢å¼ºï¼š</p><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>âœ… è‡ªåŠ¨ç¼“å­˜</td><td>ç›¸åŒ URL çš„ <code>fetch</code> è‡ªåŠ¨å»é‡</td></tr><tr><td>âœ… æ”¯æŒ <code>revalidate</code></td><td>å®ç° ISRï¼ˆå¢é‡é™æ€å†ç”Ÿï¼‰</td></tr><tr><td>âœ… ä¸ <code>Suspense</code> é…åˆ</td><td>æ”¯æŒæµå¼æ¸²æŸ“ï¼ˆStreamingï¼‰</td></tr><tr><td>âœ… è·¨ç»„ä»¶è¯·æ±‚å»é‡</td><td>å¤šä¸ªç»„ä»¶è¯·æ±‚åŒä¸€èµ„æºï¼Œåªæ‰§è¡Œä¸€æ¬¡</td></tr></tbody></table><blockquote><p>âš ï¸ å¦‚æœä½ â€œç²—æš´å°è£…â€ï¼ˆæ¯”å¦‚ç”¨ axios æˆ–è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼‰ï¼Œå¯èƒ½ä¼š<strong>ä¸¢å¤±è¿™äº›èƒ½åŠ›</strong>ã€‚</p></blockquote><hr><h2 id="âœ…-äºŒã€å¯ä»¥å°è£…çš„å†…å®¹-æ¨èåšæ³•" tabindex="-1">âœ… äºŒã€å¯ä»¥å°è£…çš„å†…å®¹ï¼ˆæ¨èåšæ³•ï¼‰ <a class="header-anchor" href="#âœ…-äºŒã€å¯ä»¥å°è£…çš„å†…å®¹-æ¨èåšæ³•" aria-label="Permalink to &quot;âœ… äºŒã€å¯ä»¥å°è£…çš„å†…å®¹ï¼ˆæ¨èåšæ³•ï¼‰&quot;">â€‹</a></h2><p>ä½ å¯ä»¥å°è£… <strong>é€šç”¨é€»è¾‘</strong>ï¼Œä½†è¦<strong>ä¿ç•™åŸç”Ÿ <code>fetch</code> çš„è°ƒç”¨</strong>ï¼Œå¹¶æ”¯æŒ Next.js ç‰¹æ€§ã€‚</p><h3 id="âœ…-æ¨èå°è£…ç‚¹" tabindex="-1">âœ… æ¨èå°è£…ç‚¹ï¼š <a class="header-anchor" href="#âœ…-æ¨èå°è£…ç‚¹" aria-label="Permalink to &quot;âœ… æ¨èå°è£…ç‚¹ï¼š&quot;">â€‹</a></h3><h4 id="_1-ç»Ÿä¸€è¯·æ±‚é…ç½®-åŸºç¡€å°è£…" tabindex="-1">1. <strong>ç»Ÿä¸€è¯·æ±‚é…ç½®ï¼ˆåŸºç¡€å°è£…ï¼‰</strong> <a class="header-anchor" href="#_1-ç»Ÿä¸€è¯·æ±‚é…ç½®-åŸºç¡€å°è£…" aria-label="Permalink to &quot;1. **ç»Ÿä¸€è¯·æ±‚é…ç½®ï¼ˆåŸºç¡€å°è£…ï¼‰**&quot;">â€‹</a></h4><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// lib/api.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> baseFetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RequestInit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> defaultHeaders</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options.headers,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ·»åŠ è®¤è¯ token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAuthToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (token) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    defaultHeaders[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers: defaultHeaders,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> api</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RequestInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    baseFetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options, method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GET&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }),</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RequestInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    baseFetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options, method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(body) }),</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å…¶ä»–æ–¹æ³•...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>ä½¿ç”¨ï¼š</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/page.tsx</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  next: { revalidate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] } </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// âœ… ä¿ç•™ Next.js ç‰¹æ€§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>âœ… ä¼˜åŠ¿ï¼š</p><ul><li>ç»Ÿä¸€ headerã€è®¤è¯</li><li>ä¿ç•™ <code>next.revalidate</code>ã€<code>tags</code> ç­‰ç‰¹æ€§</li><li>ä¸ç ´ååŸç”Ÿ <code>fetch</code> è¡Œä¸º</li></ul><hr><h4 id="_2-é”™è¯¯å¤„ç†å°è£…" tabindex="-1">2. <strong>é”™è¯¯å¤„ç†å°è£…</strong> <a class="header-anchor" href="#_2-é”™è¯¯å¤„ç†å°è£…" aria-label="Permalink to &quot;2. **é”™è¯¯å¤„ç†å°è£…**&quot;">â€‹</a></h4><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res.ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`HTTP \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">statusText</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    error.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ApiError&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> baseFetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res);</span></span></code></pre></div><hr><h4 id="_3-ç±»å‹å®‰å…¨å°è£…-é…åˆ-typescript" tabindex="-1">3. <strong>ç±»å‹å®‰å…¨å°è£…ï¼ˆé…åˆ TypeScriptï¼‰</strong> <a class="header-anchor" href="#_3-ç±»å‹å®‰å…¨å°è£…-é…åˆ-typescript" aria-label="Permalink to &quot;3. **ç±»å‹å®‰å…¨å°è£…ï¼ˆé…åˆ TypeScriptï¼‰**&quot;">â€‹</a></h4><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ApiResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchJson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RequestInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, options);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res.ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨æ³›å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchJson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  next: { revalidate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><hr><h4 id="_4-ç¼“å­˜æ ‡ç­¾è‡ªåŠ¨ç®¡ç†-é«˜çº§" tabindex="-1">4. <strong>ç¼“å­˜æ ‡ç­¾è‡ªåŠ¨ç®¡ç†ï¼ˆé«˜çº§ï¼‰</strong> <a class="header-anchor" href="#_4-ç¼“å­˜æ ‡ç­¾è‡ªåŠ¨ç®¡ç†-é«˜çº§" aria-label="Permalink to &quot;4. **ç¼“å­˜æ ‡ç­¾è‡ªåŠ¨ç®¡ç†ï¼ˆé«˜çº§ï¼‰**&quot;">â€‹</a></h4><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> API_TAGS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  users: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  posts: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;posts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  profile: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;profile&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchWithTags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RequestInit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    next: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      revalidate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      tags: tags,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options.next,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchWithTags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre></div><p>è¿™æ ·ä½ å¯ä»¥ç”¨ <code>revalidateTag(&#39;users&#39;)</code> æ‰¹é‡åˆ·æ–°ã€‚</p><hr><h2 id="âŒ-ä¸‰ã€ä¸è¦åšçš„å°è£…-é¿å…ç ´å-next-js-ä¼˜åŠ¿" tabindex="-1">âŒ ä¸‰ã€ä¸è¦åšçš„å°è£…ï¼ˆé¿å…ç ´å Next.js ä¼˜åŠ¿ï¼‰ <a class="header-anchor" href="#âŒ-ä¸‰ã€ä¸è¦åšçš„å°è£…-é¿å…ç ´å-next-js-ä¼˜åŠ¿" aria-label="Permalink to &quot;âŒ ä¸‰ã€ä¸è¦åšçš„å°è£…ï¼ˆé¿å…ç ´å Next.js ä¼˜åŠ¿ï¼‰&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>é”™è¯¯åšæ³•</th><th>é—®é¢˜</th></tr></thead><tbody><tr><td>ç”¨ <code>axios</code> æ›¿ä»£ <code>fetch</code></td><td>âŒ ä¸¢å¤±è‡ªåŠ¨ç¼“å­˜ã€revalidateã€æµå¼æ¸²æŸ“</td></tr><tr><td>å°è£…æˆ class å¹¶éšè— <code>fetch</code> è°ƒç”¨</td><td>âŒ å¯èƒ½ç ´åè¯·æ±‚å»é‡</td></tr><tr><td>åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­é¢‘ç¹ <code>fetch</code> åŒä¸€èµ„æº</td><td>âŒ æœåŠ¡ç«¯ç»„ä»¶ä¸­æ›´å¥½</td></tr></tbody></table><blockquote><p>âš ï¸ å¦‚æœä½ å¿…é¡»ç”¨ <code>axios</code>ï¼Œè¯·åªåœ¨ <strong>å®¢æˆ·ç«¯ç»„ä»¶</strong> ä¸­ä½¿ç”¨ï¼Œå¹¶åœ¨ <strong>æœåŠ¡ç«¯ç»„ä»¶ä¸­åšæŒç”¨ <code>fetch</code></strong>ã€‚</p></blockquote><hr><h2 id="âœ…-å››ã€æœ€ä½³å®è·µ-åˆ†å±‚å°è£…ç­–ç•¥" tabindex="-1">âœ… å››ã€æœ€ä½³å®è·µï¼šåˆ†å±‚å°è£…ç­–ç•¥ <a class="header-anchor" href="#âœ…-å››ã€æœ€ä½³å®è·µ-åˆ†å±‚å°è£…ç­–ç•¥" aria-label="Permalink to &quot;âœ… å››ã€æœ€ä½³å®è·µï¼šåˆ†å±‚å°è£…ç­–ç•¥&quot;">â€‹</a></h2><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. åº•å±‚ï¼šåŸç”Ÿ fetch + å¢å¼º</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// lib/fetch.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RequestInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers: { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;X-App-Version&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. ä¸­å±‚ï¼šä¸šåŠ¡ API å°è£…</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// lib/api/users.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UserApi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { next: { revalidate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] } }),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`/api/users/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. ä¸Šå±‚ï¼šé¡µé¢ä¸­ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/users/page.tsx</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UsersPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UserApi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UserList</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">={</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} /&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>âœ… ä¼˜åŠ¿ï¼š</p><ul><li>ä¿æŒ <code>fetch</code> åŸç”Ÿè°ƒç”¨</li><li>æ”¯æŒ <code>next.revalidate</code> å’Œ <code>tags</code></li><li>ç±»å‹å®‰å…¨ã€æ˜“äºç»´æŠ¤</li></ul><hr><h2 id="ğŸ¯-äº”ã€ç»“åˆ-server-actions-çš„ç»ˆææ¨¡å¼" tabindex="-1">ğŸ¯ äº”ã€ç»“åˆ Server Actions çš„ç»ˆææ¨¡å¼ <a class="header-anchor" href="#ğŸ¯-äº”ã€ç»“åˆ-server-actions-çš„ç»ˆææ¨¡å¼" aria-label="Permalink to &quot;ğŸ¯ äº”ã€ç»“åˆ Server Actions çš„ç»ˆææ¨¡å¼&quot;">â€‹</a></h2><p>ä½ ç”šè‡³å¯ä»¥æŠŠ API è°ƒç”¨å°è£…åœ¨ Server Actions ä¸­ï¼š</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/actions/user.ts</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;use server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { $fetch } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/lib/fetch&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getUsers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/legacy-system/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    next: { revalidate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/users/page.tsx</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getUsers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* æ¸²æŸ“ */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>âœ… å®Œç¾ç»“åˆï¼š</p><ul><li>å°è£…äº† API è°ƒç”¨</li><li>ä¿ç•™äº† Next.js ç¼“å­˜</li><li>å®‰å…¨ï¼ˆæœåŠ¡ç«¯æ‰§è¡Œï¼‰</li><li>æ”¯æŒ revalidate/tag</li></ul><hr><h2 id="âœ…-æ€»ç»“-å¦‚ä½•æ­£ç¡®äºŒæ¬¡å°è£…-fetch" tabindex="-1">âœ… æ€»ç»“ï¼šå¦‚ä½•æ­£ç¡®äºŒæ¬¡å°è£… <code>fetch</code> <a class="header-anchor" href="#âœ…-æ€»ç»“-å¦‚ä½•æ­£ç¡®äºŒæ¬¡å°è£…-fetch" aria-label="Permalink to &quot;âœ… æ€»ç»“ï¼šå¦‚ä½•æ­£ç¡®äºŒæ¬¡å°è£… \`fetch\`&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>åŸåˆ™</th><th>åšæ³•</th></tr></thead><tbody><tr><td>âœ… å¯ä»¥å°è£…</td><td>ç»Ÿä¸€ headerã€è®¤è¯ã€é”™è¯¯å¤„ç†ã€ç±»å‹</td></tr><tr><td>âœ… ä¿ç•™ <code>fetch</code> è°ƒç”¨</td><td>ä¸è¦ç”¨ axios æ›¿ä»£ï¼ˆæœåŠ¡ç«¯ï¼‰</td></tr><tr><td>âœ… æ”¯æŒ <code>next</code> é€‰é¡¹</td><td>è®©è°ƒç”¨è€…å¯ä»¥ä¼  <code>revalidate</code>ã€<code>tags</code></td></tr><tr><td>âœ… åˆ†å±‚è®¾è®¡</td><td><code>fetch</code> å·¥å…· â†’ API å°è£… â†’ é¡µé¢ä½¿ç”¨</td></tr><tr><td>âœ… æœåŠ¡ç«¯ä¼˜å…ˆ</td><td>å°½é‡åœ¨ Server Components ä¸­å°è£…</td></tr></tbody></table><hr><p>ğŸ¯ <strong>ä¸€å¥è¯å»ºè®®</strong>ï¼š</p><blockquote><p><strong>â€œå°è£…çš„æ˜¯ä¾¿åˆ©æ€§ï¼Œä¸æ˜¯æ›¿æ¢ <code>fetch</code>â€ â€”â€” ç”¨è½»é‡å°è£…æå‡å¼€å‘æ•ˆç‡ï¼Œä½†ä¿ç•™ Next.js çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚</strong></p></blockquote><p>å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥æä¾›ä¸€ä¸ªå®Œæ•´çš„ <code>lib/api.ts</code> æ¨¡æ¿ï¼ŒåŒ…å«è®¤è¯ã€é”™è¯¯å¤„ç†ã€ç±»å‹å®šä¹‰ã€æ ‡ç­¾ç®¡ç†ç­‰ ğŸ˜Š</p><p>åŠ¨æ€å‡½æ•°ï¼šcookies headers fetch(url, {cache: &quot;no-store&quot;})</p><ul><li>è·¯ç”±é…ç½® <ul><li>dynamic <ul><li>auto</li><li>force-dynamic</li><li>error</li><li>force-static</li></ul></li><li>dynamicParams <ul><li>true</li><li>false</li></ul></li><li>revalidate <ul><li>false</li><li>0</li><li>number</li></ul></li><li>fetchCache <ul><li>auto</li><li>force-cache</li><li>only-cache</li><li>default-no-store</li></ul></li><li>runtime <ul><li>nodejs</li><li>edge</li></ul></li><li>preferredRegion <ul><li>auto</li><li>home</li><li>usã€euã€ap</li></ul></li><li>maxDuration</li><li>generateStaticParams</li></ul></li></ul><table tabindex="0"><thead><tr><th>ä½ çš„éœ€æ±‚</th><th>æ¨èé…ç½®</th></tr></thead><tbody><tr><td>å®Œå…¨é™æ€é¡µé¢ï¼ˆå¦‚åšå®¢ï¼‰</td><td><code>dynamic = &#39;force-static&#39;</code> + <code>generateStaticParams</code></td></tr><tr><td>å®æ—¶å†…å®¹ï¼ˆå¦‚ä»ªè¡¨ç›˜ï¼‰</td><td><code>dynamic = &#39;force-dynamic&#39;</code></td></tr><tr><td>å†…å®¹å¶å°”æ›´æ–°</td><td><code>revalidate = 60</code></td></tr><tr><td>å…¨çƒç”¨æˆ·è®¿é—®</td><td><code>runtime = &#39;edge&#39;</code> + <code>preferredRegion = &#39;auto&#39;</code></td></tr><tr><td>é•¿æ—¶é—´ä»»åŠ¡</td><td><code>maxDuration = 60</code>ï¼ˆVercel Proï¼‰</td></tr><tr><td>å®‰å…¨æ§åˆ¶è·¯ç”±</td><td><code>dynamicParams = false</code></td></tr></tbody></table><p>Google ä¸‰å¤§æ ¸å¿ƒç½‘é¡µæŒ‡æ ‡</p><ul><li>LCP</li><li>INP</li><li>CLS</li></ul><p>typescript mvvc for await ios android è¯ä¹¦ vue2 vue3 åŒºåˆ« es5 å’Œ es6 watch computed</p><ol><li><p>è¯·æ±‚è®°å¿†</p><p>React ç»„ä»¶æ ‘å†…æœ‰æ•ˆ(layoutã€ pageã€ generateMetaData)</p></li><li><p>æ•°æ®ç¼“å­˜</p></li></ol><ul><li><p>é…ç½®</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}ã€ {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revalidata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span></code></pre></div></li><li><p>æŒ‰éœ€é‡æ–°éªŒè¯</p><ul><li><p>åŸºäºæ ‡ç­¾</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;news&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]}}</span></span></code></pre></div></li><li><p>åŸºäºè·¯å¾„</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revalidata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span></code></pre></div></li></ul></li></ul><ol start="3"><li>å®Œæ•´è·¯ç”±ç¼“å­˜</li></ol><ul><li>ä»…é€‚ç”¨äºé™æ€è·¯ç”±</li></ul><ol start="4"><li>è·¯ç”±ç¼“å­˜</li></ol>`,64)]))}const y=i(h,[["render",l]]);export{g as __pageData,y as default};
